#!/bin/bash
DIR=$(dirname $(dirname $PWD))
[ $(whoami) != "root" ] && (echo "$(basename "$0") setup requires superuser privileges to run !" && exit 1 )
ping -q -w 1 -c 1 `ip r | grep default | cut -d ' ' -f 3` > /dev/null || (echo  echo "$(basename "$0") setup script requires a network connection to run !" && exit 1) 

# get get up to the newest state
apt-get update && apt-get -y upgrade

# maintenance 
#apt-get -y install aptitude										# optional
#apt-get -y install bmon											# optional
#apt-get -y install htop											# optional


# unzip (for q) 
apt-get -y install unzip

# rlwrap (for q)
#apt-get -y install rlwrap 											# optional

# erlang
apt-get -y install erlang-base
apt-get -y install erlang-asn1
apt-get -y install erlang-public-key
apt-get -y install erlang-ssl
apt-get -y install erlang-inets

# rebar
wget https://s3.amazonaws.com/rebar3/rebar3
chmod +x ./rebar3 && cp ./rebar3 /bin/.

# auto-starts
cp $DIR/resources/scripts/hydroza_autostart /etc/init.d/
chmod +x /etc/init.d/hydroza_autostart

# open up port 1843 (for q)
ufw allow 1843
# open up port 1844 (for cli_server)
ufw allow 1844

# kdb+ setup
#echo "alias q='QHOME=~/q rlwrap -r ~/q/l32arm/q'" >> ~/.bashrc		# optional
cd $DIR/resources/archives/kdb
unzip kdb_arm.zip
#rm q/trade.q q/sp.q q/q.q 											# optional 
cp -r q ~/.
cd -


# clean up
#rm -f $DIR/README.md 												# optional
#rm -f -r $DIR/resources												# optional
#apt-get -y autoremove 												# optional
#apt-get -y autoclean												# optional